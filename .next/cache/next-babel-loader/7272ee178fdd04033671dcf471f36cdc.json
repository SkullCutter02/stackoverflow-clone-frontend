{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React, { useState, useContext, useRef } from \"react\";\nimport { useQuery, useQueryClient } from \"react-query\";\nimport PageHandlers from \"../components/PageHandlers\";\nimport host from \"../utils/host\";\nimport { UserContext } from \"../context/UserContext\";\nimport { getCookie } from \"../utils/functions\";\n\nvar AdminPage = function AdminPage() {\n  var _useState = useState(1),\n      page = _useState[0],\n      setPage = _useState[1];\n\n  var userContext = useContext(UserContext);\n  var queryClient = useQueryClient();\n  var nameRef = useRef(null);\n  var descriptionRef = useRef(null);\n\n  var fetchRequests = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(page) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(\"\".concat(host, \"/requests?page=\").concat(page, \"&limit=20\"));\n\n            case 2:\n              res = _context.sent;\n              _context.next = 5;\n              return res.json();\n\n            case 5:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function fetchRequests(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var _useQuery = useQuery([\"requests\", page], function () {\n    return fetchRequests(page);\n  }, {\n    keepPreviousData: true\n  }),\n      isLoading = _useQuery.isLoading,\n      isError = _useQuery.isError,\n      error = _useQuery.error,\n      data = _useQuery.data,\n      isPreviousData = _useQuery.isPreviousData;\n\n  var postCommunity = function postCommunity(e) {\n    e.preventDefault();\n\n    if (userContext.user) {\n      fetch(\"\".concat(host, \"/communities\"), {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          name: nameRef.current.value,\n          description: descriptionRef.current.value,\n          uuid: userContext.user.uuid\n        })\n      }).then(function (res) {\n        return res.json();\n      }).then(function (data) {\n        if (data.msg) {\n          console.log(data.msg);\n        } else {\n          nameRef.current.value = \"\";\n          descriptionRef.current.value = \"\";\n        }\n      });\n    }\n  };\n\n  var deleteRequest = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(uuid) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch(\"\".concat(host, \"/requests/\").concat(uuid), {\n                method: \"DELETE\",\n                headers: {\n                  Authorization: \"Bearer \".concat(getCookie(\"token\"))\n                }\n              });\n\n            case 2:\n              _context2.next = 4;\n              return queryClient.prefetchQuery([\"requests\", page]);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function deleteRequest(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (userContext.user === undefined) {\n    return /*#__PURE__*/_jsx(\"div\", {});\n  }\n\n  return /*#__PURE__*/_jsxs(React.Fragment, {\n    children: [userContext.user.role === \"god\" ? /*#__PURE__*/_jsx(\"div\", {\n      className: \"jsx-2918500353\" + \" \" + \"admin-area-container\",\n      children: isLoading ? /*#__PURE__*/_jsx(\"div\", {\n        className: \"jsx-2918500353\",\n        children: \"Loading...\"\n      }) : isError ? /*#__PURE__*/_jsx(\"div\", {\n        className: \"jsx-2918500353\",\n        children: error.message\n      }) : /*#__PURE__*/_jsxs(\"div\", {\n        className: \"jsx-2918500353\" + \" \" + \"admin-area\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-2918500353\" + \" \" + \"requests-container\",\n          children: [data.requests.map(function (request) {\n            return /*#__PURE__*/_jsxs(\"div\", {\n              className: \"jsx-2918500353\",\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                className: \"jsx-2918500353\",\n                children: request.name\n              }), /*#__PURE__*/_jsx(\"a\", {\n                href: request.link,\n                style: {\n                  color: \"white\"\n                },\n                className: \"jsx-2918500353\",\n                children: request.link\n              }), /*#__PURE__*/_jsx(\"button\", {\n                onClick: function onClick() {\n                  return deleteRequest(request.uuid);\n                },\n                className: \"jsx-2918500353\",\n                children: \"Remove\"\n              })]\n            });\n          }), /*#__PURE__*/_jsx(PageHandlers, {\n            page: page,\n            setPage: setPage,\n            isPreviousData: isPreviousData,\n            hasMore: data.hasMore,\n            width: 100,\n            flex: \"flex-start\"\n          })]\n        }), /*#__PURE__*/_jsxs(\"form\", {\n          onSubmit: postCommunity,\n          className: \"jsx-2918500353\",\n          children: [/*#__PURE__*/_jsx(\"input\", {\n            type: \"text\",\n            placeholder: \"Name: \",\n            ref: nameRef,\n            required: true,\n            className: \"jsx-2918500353\"\n          }), /*#__PURE__*/_jsx(\"textarea\", {\n            cols: 30,\n            rows: 10,\n            placeholder: \"Description: \",\n            ref: descriptionRef,\n            required: true,\n            className: \"jsx-2918500353\"\n          }), /*#__PURE__*/_jsx(\"button\", {\n            type: \"submit\",\n            className: \"jsx-2918500353\",\n            children: \"Submit\"\n          })]\n        })]\n      })\n    }) : /*#__PURE__*/_jsx(\"div\", {\n      className: \"jsx-2918500353\" + \" \" + \"rickroll\",\n      children: /*#__PURE__*/_jsx(\"img\", {\n        src: \"/rick.gif\",\n        alt: \"rick\",\n        className: \"jsx-2918500353\"\n      })\n    }), /*#__PURE__*/_jsx(_JSXStyle, {\n      id: \"2918500353\",\n      children: [\".rickroll.jsx-2918500353{margin:100px auto;}\", \".rickroll.jsx-2918500353 img.jsx-2918500353{display:block;margin:0 auto;}\", \".admin-area.jsx-2918500353{margin:200px 200px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}\", \"form.jsx-2918500353 input.jsx-2918500353,form.jsx-2918500353 textarea.jsx-2918500353{display:block;resize:none;}\"]\n    })]\n  });\n};\n\nexport default AdminPage;","map":null,"metadata":{},"sourceType":"module"}